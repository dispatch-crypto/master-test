<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Courier Box Label</title>
    <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>
    <style>
        /* Styles for a standard 4x6 inch shipping label */
        @page {
            size: 4in 6in;
            margin: 0.1in;
        }
        @media print {
            body {
                margin: 0;
                padding: 0;
            }
            .no-print {
                display: none;
            }
        }
        body {
            font-family: Arial, sans-serif;
            margin: 0;
        }
        .label {
            width: 3.8in;
            height: 5.8in;
            border: 2px solid #000;
            padding: 10px;
            display: flex;
            flex-direction: column;
        }
        .row {
            display: flex;
            justify-content: space-between;
            align-items: baseline;
        }
        .sep {
            border-top: 2px solid #000;
            margin: 8px 0;
        }
        .h2 {
            font-size: 14px;
            font-weight: 700;
        }
        .mono {
            font-family: "Courier New", monospace;
        }
        .small {
            font-size: 10px;
        }
        .bold {
            font-weight: 700;
        }
        .boxid {
            font-size: 20px;
            font-weight: 900;
        }
        .block {
            margin: 5px 0;
        }
        .two-col {
            display: grid;
            grid-template-columns: 1.1fr 0.9fr;
            gap: 10px;
        }
        .barcode {
            height: 50px;
            width: 100%;
        }
        ul {
            margin: 4px 0;
            padding-left: 16px;
            font-size: 10px;
        }
    </style>
</head>
<body>
    <div class="label">
        <!-- Header -->
        <div class="row">
            <div><span class="h2">Courier:</span> <span id="courier_name">-</span></div>
            <div><span class="h2">Docket:</span> <span id="docket_no" class="mono">—</span></div>
        </div>
        <div class="small">Service: <span id="service_type">Prepaid</span> • Date: <span id="ship_date">—</span></div>
        <div class="sep"></div>

        <!-- Box ID & Barcode -->
        <div class="block text-center">
            <div class="h2">BOX ID</div>
            <div class="boxid mono" id="box_id">BOX0001</div>
            <svg id="box_barcode" class="barcode"></svg>
        </div>
        <div class="sep"></div>

        <!-- Addresses -->
        <div class="two-col block">
            <div>
                <div class="h2">TO (Consignee)</div>
                <div class="bold" id="store_name">Store Name</div>
                <div id="addr">123 Main Street</div>
                <div><span id="city">City</span> – <span id="pincode">PIN</span></div>
                <div>Ph: <span id="mobile">9xxxxxxxxx</span></div>
                <div class="small bold">Store Code: <span id="store_code">000</span></div>
            </div>
            <div>
                <div class="h2">FROM (Shipper)</div>
                <div class="bold">GKB Eyecare Pvt Ltd</div>
                <div class="small">B-48, 1st Floor, Sector - 88</div>
                <div class="small">Noida, UP – 201306</div>
                <div class="small">Ph: 9289012244</div>
            </div>
        </div>
        <div class="sep"></div>

        <!-- Contents -->
        <div class="block flex-grow">
            <div class="h2">CONTENTS</div>
            <ul id="orders_list" class="small">
                <!-- Order items will be injected here -->
            </ul>
            <div class="small" id="more_orders" style="display:none;">+<span id="more_count">0</span> more</div>
        </div>

        <!-- Footer -->
        <div class="sep"></div>
        <div class="row small">
            <div>Delivery Group: <b id="dgid">—</b></div>
            <div>Status: <b id="status">Packed</b></div>
        </div>
    </div>
    
    <div class="no-print" style="text-align: center; margin-top: 20px;">
        <button onclick="window.print()" style="padding: 10px 20px; font-size: 16px;">Print</button>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const params = new URLSearchParams(window.location.search);
            const set = (id, val) => {
                const el = document.getElementById(id);
                if (el) el.textContent = val ?? '—';
            };

            // Populate data from URL
            set('courier_name', params.get('courierName'));
            set('docket_no', params.get('docketNumber'));
            set('ship_date', new Date(params.get('shipmentDate')).toLocaleDateString('en-GB'));
            set('box_id', params.get('boxId'));
            set('store_code', params.get('storeCode'));
            set('store_name', params.get('storeName'));
            set('addr', params.get('address'));
            set('city', params.get('city'));
            set('pincode', params.get('pincode'));
            set('mobile', params.get('phone'));
            set('dgid', params.get('deliveryGroupId'));
            set('status', params.get('boxStatus'));

            // Generate Barcode
            const boxId = params.get('boxId');
            if (boxId) {
                JsBarcode("#box_barcode", boxId, {
                    format: "CODE128",
                    width: 2.5,
                    height: 50,
                    displayValue: false,
                    margin: 0
                });
            }

            // Populate order list (show up to 5)
            const orders = params.get('orders') ? JSON.parse(params.get('orders')) : [];
            const ul = document.getElementById('orders_list');
            orders.slice(0, 5).forEach(o => {
                const li = document.createElement('li');
                li.textContent = o;
                ul.appendChild(li);
            });
            const extra = orders.length - 5;
            if (extra > 0) {
                document.getElementById('more_orders').style.display = 'block';
                set('more_count', extra);
            }

            // Automatically trigger print dialog
            // window.print();
        });
    </script>
</body>
</html>
